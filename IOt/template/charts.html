<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <title>Dashboard</title>

    <!-- Custom fonts for this template-->
    <link href="/static/css/all.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="/static/css/admin.css" rel="stylesheet">


</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'home' %}">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Dashboard</div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" href="{% url 'home' %}">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

           

            <!-- Nav Item - Charts -->
            <li class="nav-item">
                <a class="nav-link" href="{% url 'charts' %}">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>Charts</span></a>
            </li>

            <!-- Nav Item - Tables -->
            <li class="nav-item">
                <a class="nav-link" href="{% url 'table' %}">
                    <i class="fas fa-fw fa-table"></i>
                    <span>PH</span></a> 
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'turbidity' %}">
                    <i class="fas fa-fw fa-table"></i>
                    <span>Turbidity</span></a> 
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'location' %}">
                    <i class="fas fa-fw fa-table"></i>
                    <span>location</span></a> 
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <!-- <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div> -->

         

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-light topbar mb-4 static-top shadow">
                    <h1 class="h3 mb-0 text-gray-800">Water Monitoring System</h1>

                    <!-- Sidebar Toggle (Topbar) -->
                    
                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <!-- <h1 class="h3 mb-2 text-gray-800">Charts</h1>
                    <p class="mb-4">Chart.js is a third party plugin that is used to generate the charts in this theme.
                        The charts below have been customized - for further customization options, please visit the <a
                            target="_blank" href="https://www.chartjs.org/docs/latest/">official Chart.js
                            documentation</a>.</p> -->

                    <!-- Content Row -->
                    <div class="row">

                        <div class="col-xl-8 col-lg-7">

                            <!-- Area Chart -->
                            <div class="card shadow mb-3">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">PH Chart</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="dataChart" ></canvas>
                                    </div>
                                    <hr>
                                    <!-- Styling for the area chart can be found in the
                                    <code>/js/demo/chart-area-demo.js</code> file. -->
                                </div>
                            </div>

                            <!-- Bar Chart -->
                            <div class="card shadow mb-4 ">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Bar Chart</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-bar">
                                        <canvas id="turchart"></canvas>
                                    </div>
                                    <hr>
                                    <!-- Styling for the bar chart can be found in the
                                    <code>/js/demo/chart-bar-demo.js</code> file. -->
                                </div>
                            </div>
 
                        </div>

                        <!-- Donut Chart -->
                        <div class="col-xl-4 col-lg-5 " >
                            <div class="card shadow mb-5">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">PH</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-pie pt-4">
                                        The system is a comprehensive tool designed to monitor and analyze the pH levels of water bodies. pH is a critical parameter that determines the acidity or alkalinity of water and has a significant impact on aquatic ecosystems, human health, and industrial processes. This dashboard provides real-time insights into pH data, enabling users to make informed decisions and take necessary actions to safeguard water quality.
                                        <canvas id="myPieChart">
                                            
                                        </canvas>
                                    </div>
                                    <hr>
                                    <!-- Styling for the donut chart can be found in the
                                    <code>/js/demo/chart-pie-demo.js</code> file. -->
                                </div>
                            </div>
                            
                            <div class="card shadow mb-4 ">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Turbidity</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-pie pt-4">
                                        The System is  designed to monitor and track turbidity levels in water bodies. Turbidity is a critical parameter that measures the cloudiness or haziness of water caused by suspended particles. This chart provides real-time insights into turbidity data, allowing users to assess water clarity and make informed decisions to maintain water quality and environmental health.                                        <canvas id="myPieChart">
                                            
                                        </canvas>
                                    </div>
                                    <hr>
                                    <!-- Styling for the donut chart can be found in the
                                    <code>/js/demo/chart-pie-demo.js</code> file. -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Your Website 2020</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <script>
        const channelId = 2209876;
        const apiKey = "NV1L4Q2QK0FV0HMF"; // Corrected the apiKey variable
        const apiUrl = `https://api.thingspeak.com/channels/${channelId}/feeds.json?api_key=${apiKey}`;
        const dataCount = 40; // Number of data points to display
    
        // Initialize an empty array to store the chart data
        let chartData = [];
       
        
    
        // Create a chart using Chart.js
        const ctx = document.getElementById('dataChart').getContext('2d');
        const dataChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'ThingSpeak Data',
              data: chartData,
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderWidth: 1,
            }]
          },
          options: {
            responsive: true,
            scales: {
              x: {
                type: 'time',
                time: {
                //   parser: 'YYYY-MM-DDTHH:mm:ssZ', // Use the correct format for your date/time data
                //   unit: 'day'
                }
              },
              y: {
                beginAtZero: true
              }
            }
          }
        });
    
        function fetchDataAndAddToChart() {
          // Fetch data from ThingSpeak API
          fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
              // Process the data and extract the new data points
              const newData = data.feeds.slice(-dataCount);
              const labels = newData.map(feed => moment(feed.created_at).toDate());
              const values = newData.map(feed => parseFloat(feed.field1));
    
              // Push the new data points to the chart data
              dataChart.data.labels.push(...labels);
              dataChart.data.datasets[0].data.push(...values);
    
              // Limit the number of data points to the specified count
              if (dataChart.data.labels.length > dataCount) {
                dataChart.data.labels.splice(0, dataChart.data.labels.length - dataCount);
                dataChart.data.datasets[0].data.splice(0, dataChart.data.datasets[0].data.length - dataCount);
              }
    
              // Update the chart
              dataChart.update();
            })
            .catch(error => {
              console.error('Error fetching data:', error);
            });
        }
        
    
        // Fetch and add data to the chart on page load
        fetchDataAndAddToChart();
        // fetchAndAddToChart();

    
        // Set an interval to fetch new data every 30 seconds (adjust the interval as needed)
        setInterval(fetchDataAndAddToChart, 3000);
      </script>

<script>
    const channelId1 = 2209876;
    const apiKey1 = "NV1L4Q2QK0FV0HMF"; // Corrected the apiKey variable
    const apiUrl1 = `https://api.thingspeak.com/channels/${channelId1}/feeds.json?api_key=${apiKey1}`;
    const dataCount1 = 40; // Number of data points to display

    // Initialize an empty array to store the chart data
    let chartData1 = [];
   
    

    // Create a chart using Chart.js
    const ctx1 = document.getElementById('turchart').getContext('2d');
    const dataChart1 = new Chart(ctx1, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'ThingSpeak Data',
          data: chartData1,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderWidth: 1,
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            type: 'time',
            time: {
            //   parser: 'YYYY-MM-DDTHH:mm:ssZ', // Use the correct format for your date/time data
            //   unit: 'day'
            }
          },
          y: {
            beginAtZero: true
          }
        }
      }
    });

    function fetchAndAddToChart() {
      // Fetch data from ThingSpeak API
      fetch(apiUrl1)
        .then(response => response.json())
        .then(data => {
          // Process the data and extract the new data points
          const newData = data.feeds.slice(-dataCount1);
          const labels = newData.map(feed => moment(feed.created_at).toDate());
          const values = newData.map(feed => parseFloat(feed.field2));

          // Push the new data points to the chart data
          dataChart1.data.labels.push(...labels);
          dataChart1.data.datasets[0].data.push(...values);

          // Limit the number of data points to the specified count
          if (dataChart1.data.labels.length > dataCount1) {
            dataChart1.data.labels.splice(0, dataChart1.data.labels.length - dataCount1);
            dataChart1.data.datasets[0].data.splice(0, dataChart1.data.datasets[0].data.length - dataCount1);
          }

          // Update the chart
          dataChart1.update();
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    }
    

    // Fetch and add data to the chart on page load
    fetchAndAddToChart();
    // fetchAndAddToChart();


    // Set an interval to fetch new data every 30 seconds (adjust the interval as needed)
    setInterval(fetchAndAddToChart, 3000);
  </script>

</body>

</html>